
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="05567370-510d-5e64-b0b9-86d67f0d300e")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,630374,310445,e=>{"use strict";e.s(["Dialog",()=>a,"DialogContent",()=>u,"DialogDescription",()=>p,"DialogFooter",()=>f,"DialogHeader",()=>h,"DialogTitle",()=>m,"DialogTrigger",()=>l],630374);var t=e.i(843476),r=e.i(326999),s=e.i(271645),o=e.i(647163);e.s(["CloseIcon",()=>n],310445);var i=e.i(37727);let n=e=>{let{className:r,onClick:s}=e;return(0,t.jsx)("div",{children:(0,t.jsx)(i.X,{className:(0,o.cn)("bg-accent h-[18px] w-[18px] cursor-pointer rounded-full border-transparent p-[3px] font-bold text-black",r),onClick:s})})},a=r.Root,l=r.Trigger,c=r.Portal;r.Close;let d=s.forwardRef((e,s)=>{let{className:i,...n}=e;return(0,t.jsx)(r.Overlay,{ref:s,className:(0,o.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50",o.blurOverlayClasses,i),...n})});d.displayName=r.Overlay.displayName;let u=s.forwardRef((e,s)=>{let{className:i,children:a,...l}=e;return(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{}),(0,t.jsxs)(r.Content,{ref:s,className:(0,o.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] fixed top-[50%] left-[50%] z-50 grid w-[90%] max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border p-6 shadow-lg duration-200 sm:rounded-lg",i),...l,children:[a,(0,t.jsxs)(r.Close,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[(0,t.jsx)(n,{}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=r.Content.displayName;let h=e=>{let{className:r,...s}=e;return(0,t.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",r),...s})};h.displayName="DialogHeader";let f=e=>{let{className:r,...s}=e;return(0,t.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...s})};f.displayName="DialogFooter";let m=s.forwardRef((e,s)=>{let{className:i,...n}=e;return(0,t.jsx)(r.Title,{ref:s,className:(0,o.cn)("text-lg leading-none tracking-tight",i),...n})});m.displayName=r.Title.displayName;let p=s.forwardRef((e,s)=>{let{className:i,...n}=e;return(0,t.jsx)(r.Description,{ref:s,className:(0,o.cn)("text-muted-foreground text-sm",i),...n})});p.displayName=r.Description.displayName},979083,(e,t,r)=>{var s=e.r(101320);t.exports=function(e){return s(e)?void 0:e}},691027,(e,t,r)=>{var s=e.r(892708),o=e.r(64324),i=e.r(785834),n=e.r(186287),a=e.r(372351),l=e.r(979083),c=e.r(6227),d=e.r(807889);t.exports=c(function(e,t){var r={};if(null==e)return r;var c=!1;t=s(t,function(t){return t=n(t,e),c||(c=t.length>1),t}),a(e,d(e),r),c&&(r=o(r,7,l));for(var u=t.length;u--;)i(r,t[u]);return r})},89842,767317,e=>{"use strict";e.s(["extractRandomSuffixFromTestDocKey",()=>i,"getOriginalIdFromTestId",()=>n,"getTestDocId",()=>o,"getTestDocIdWithSuffix",()=>s],89842);var t=e.i(447285);e.s(["generateRandomSuffixForTestDoc",()=>r],767317);let r=()=>{let e="abcdefghijklmnopqrstuvwxyz0123456789",t="";for(let r=0;r<10;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},s=(e,r)=>{if(!e)return null;if(e.startsWith(t.testIdPrefix)){let s=e.split("--");if(s.length>=3){let e=s[1],o=e.split("-"),i=s.slice(2).join("--"),n=1===o.length?"".concat(e,"-").concat(r):"".concat(o[0],"-").concat(r);return"".concat(t.testIdPrefix,"--").concat(n,"--").concat(i)}}return"".concat(t.testIdPrefix,"--").concat(r,"--").concat(e)},o=e=>s(e,r()),i=e=>{let r=e.split("--");if(r.length<2||!e.startsWith(t.testIdPrefix))throw Error("Invalid test doc key format: ".concat(e));return r[1]},n=e=>{let t=e.split("--");if(t.length<3)throw Error("Invalid test doc key format: ".concat(e));return t[2]}},987749,e=>{"use strict";e.s(["filterBool",()=>t]);let t=e=>e.filter(Boolean)},829584,(e,t,r)=>{t.exports=function(e,t,r){for(var s=-1,o=null==e?0:e.length;++s<o;)if(r(t,e[s]))return!0;return!1}},208484,(e,t,r)=>{var s=e.r(106966),o=e.r(591692),i=e.r(899850);t.exports=s&&1/i(new s([,-0]))[1]==1/0?function(e){return new s(e)}:o},910339,(e,t,r)=>{var s=e.r(27493),o=e.r(146515),i=e.r(829584),n=e.r(315262),a=e.r(208484),l=e.r(899850);t.exports=function(e,t,r){var c=-1,d=o,u=e.length,h=!0,f=[],m=f;if(r)h=!1,d=i;else if(u>=200){var p=t?null:a(e);if(p)return l(p);h=!1,d=n,m=new s}else m=t?[]:f;e:for(;++c<u;){var y=e[c],v=t?t(y):y;if(y=r||0!==y?y:0,h&&v==v){for(var g=m.length;g--;)if(m[g]===v)continue e;t&&m.push(v),f.push(y)}else d(m,v,r)||(m!==f&&m.push(v),f.push(y))}return f}},909817,(e,t,r)=>{var s=e.r(910339);t.exports=function(e){return e&&e.length?s(e):[]}},386601,e=>{"use strict";e.s(["getUpdatedPermissionsForCollection",()=>a],386601);var t=e.i(987749),r=e.i(98925),s=e.i(946217),o=e.i(411595),i=e.i(909817);let n={report:{directUserReadReferences:["patientKey"]},dataPoint:{arrayRecordReferences:["reportKeys"],directUserReadReferences:["userKey"]},healthNote:{singleRecordReferences:["reportKey"],directUserReadReferences:["userKey"]},healthBotMessage:{directUserWriteReferences:["userKey"]},sourceFile:{directUserWriteReferences:["userKey"],arrayRecordReferences:["reportKeys"]},clinicalFollowup:{directUserReadReferences:["userKey"],singleRecordReferences:["reportKey"]},healthOptimisation:{directUserReadReferences:["userKey"],singleRecordReferences:["reportKey"]},userFeedback:{directUserWriteReferences:["userKey"]},booking:{directUserReadReferences:["userKey"]},questionnaireResponses:{directUserWriteReferences:["userKey"]},processingJob:{directUserReadReferences:["triggeredByUserId"],directUserWriteReferences:["triggeredByUserId"]}},a=(e,a)=>{let{visibleTo:l,permissionsMap:c}=(e=>{var t,r,s;let o={},i=[];return null==e||null==(t=e.read)||t.forEach(e=>{e&&(o[e]="read",i.push(e))}),null==e||null==(r=e.write)||r.forEach(e=>{e&&(o[e]="write",i.push(e))}),null==e||null==(s=e.admin)||s.forEach(e=>{e&&(o[e]="admin",i.push(e))}),{permissionsMap:o,visibleTo:i}})(((e,r)=>{var s,o,n,a,l;return{permisionRecordIds:(0,i.default)([e.uid,(null==(s=r.singleRecordReferences)?void 0:s.map(t=>e[t]))||[],(null==(o=r.arrayRecordReferences)?void 0:o.flatMap(t=>e[t]))||[]].flat()),directPermissionUserKeys:{read:(0,t.filterBool)((null==(n=r.directUserReadReferences)?void 0:n.flatMap(t=>e[t]))||[]),write:(0,t.filterBool)((null==(a=r.directUserWriteReferences)?void 0:a.flatMap(t=>e[t]))||[]),admin:(0,t.filterBool)((null==(l=r.directUserAdminReferences)?void 0:l.flatMap(t=>e[t]))||[])}}})(a,n[e]||{}).directPermissionUserKeys),d=l.length>0?{visibleTo:(0,r.arrayUnion)(...l)}:{},u=(0,s.default)(c);return(0,o.default)(a,{...a,...d,...u?{}:{permissions:c}})}},387888,881285,e=>{"use strict";e.s(["getUuid",()=>a],387888);var t=e.i(422233);e.s(["applyGlobalOptions",()=>i],881285);var r=e.i(179704),s=e.i(669927),o=e.i(736749);let i=e=>{e||(e={});let t={};if((0,o.isServerside)()){let e=(0,r.getBeContext)();e&&(t=e.defaultWriteOptions||{})}else t=(0,s.getGlobalWriteOptions)();return{...t,...e}};var n=e.i(447285);let a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(e).isTestDoc?"".concat(n.testIdPrefix).concat((0,t.v4)()):(0,t.v4)()}},873282,(e,t,r)=>{var s=e.r(653336);t.exports=function(e){return"function"==typeof e?e:s}},947423,(e,t,r)=>{var s=e.r(163799),o=e.r(873282);t.exports=function(e,t){return e&&s(e,o(t))}},784138,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ValidationError=void 0,r.ValidationError=class extends Error{static createFrom(e){return new this(e)}constructor(e){super(e),Error.captureStackTrace&&"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}},223088,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PromisePoolError=void 0,r.PromisePoolError=class extends Error{static createFrom(e,t){return new this(e,t)}messageFrom(e){return e instanceof Error||"object"==typeof e?e.message:"string"==typeof e||"number"==typeof e?e.toString():""}constructor(e,t){super(),this.raw=e,this.item=t,this.name=this.constructor.name,this.message=this.messageFrom(e),Error.captureStackTrace&&"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}},907523,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StopThePromisePoolError=void 0,r.StopThePromisePoolError=class extends Error{}},733400,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PromisePoolExecutor=void 0;let s=e.r(832405),o=e.r(784138),i=e.r(223088),n=e.r(907523);r.PromisePoolExecutor=class{useConcurrency(e){if(!this.isValidConcurrency(e))throw o.ValidationError.createFrom('"concurrency" must be a number, 1 or up. Received "'.concat(e,'" (').concat(typeof e,")"));return this.meta.concurrency=e,this}isValidConcurrency(e){return"number"==typeof e&&e>=1}withTaskTimeout(e){return this.meta.taskTimeout=e,this}concurrency(){return this.meta.concurrency}useCorrespondingResults(e){return this.meta.shouldResultsCorrespond=e,this}shouldUseCorrespondingResults(){return this.meta.shouldResultsCorrespond}taskTimeout(){return this.meta.taskTimeout}for(e){return this.meta.items=e,this}items(){return this.meta.items}itemsCount(){let e=this.items();return Array.isArray(e)?e.length:NaN}tasks(){return this.meta.tasks}activeTaskCount(){return this.activeTasksCount()}activeTasksCount(){return this.tasks().length}processedItems(){return this.meta.processedItems}processedCount(){return this.processedItems().length}processedPercentage(){return this.processedCount()/this.itemsCount()*100}results(){return this.meta.results}errors(){return this.meta.errors}withHandler(e){return this.handler=e,this}hasErrorHandler(){return!!this.errorHandler}handleError(e){return this.errorHandler=e,this}onTaskStarted(e){return this.onTaskStartedHandlers=e,this}onTaskFinished(e){return this.onTaskFinishedHandlers=e,this}hasReachedConcurrencyLimit(){return this.activeTasksCount()>=this.concurrency()}stop(){throw this.markAsStopped(),new n.StopThePromisePoolError}markAsStopped(){return this.meta.stopped=!0,this}isStopped(){return this.meta.stopped}async start(){return await this.validateInputs().prepareResultsArray().process()}validateInputs(){if("function"!=typeof this.handler)throw o.ValidationError.createFrom("The first parameter for the .process(fn) method must be a function");let e=this.taskTimeout();if(!(null==e||"number"==typeof e&&e>=0))throw o.ValidationError.createFrom('"timeout" must be undefined or a number. A number must be 0 or up. Received "'.concat(String(e),'" (').concat(typeof e,")"));if(!this.areItemsValid())throw o.ValidationError.createFrom('"items" must be an array, an iterable or an async iterable. Received "'.concat(typeof this.items(),'"'));if(this.errorHandler&&"function"!=typeof this.errorHandler)throw o.ValidationError.createFrom('The error handler must be a function. Received "'.concat(typeof this.errorHandler,'"'));return this.onTaskStartedHandlers.forEach(e=>{if(e&&"function"!=typeof e)throw o.ValidationError.createFrom('The onTaskStarted handler must be a function. Received "'.concat(typeof e,'"'))}),this.onTaskFinishedHandlers.forEach(e=>{if(e&&"function"!=typeof e)throw o.ValidationError.createFrom('The error handler must be a function. Received "'.concat(typeof e,'"'))}),this}areItemsValid(){let e=this.items();return!!Array.isArray(e)||"function"==typeof e[Symbol.iterator]||"function"==typeof e[Symbol.asyncIterator]}prepareResultsArray(){let e=this.items();return Array.isArray(e)&&this.shouldUseCorrespondingResults()&&(this.meta.results=Array(e.length).fill(s.PromisePool.notRun)),this}async process(){let e=0;for await(let t of this.items()){if(this.isStopped())break;this.shouldUseCorrespondingResults()&&(this.results()[e]=s.PromisePool.notRun),this.startProcessing(t,e),e+=1,await this.waitForProcessingSlot()}return await this.drained()}async waitForProcessingSlot(){for(;this.hasReachedConcurrencyLimit();)await this.waitForActiveTaskToFinish()}async waitForActiveTaskToFinish(){await Promise.race(this.tasks())}startProcessing(e,t){let r=this.createTaskFor(e,t).then(e=>{this.save(e,t).removeActive(r)}).catch(async s=>{await this.handleErrorFor(s,e,t),this.removeActive(r)}).finally(()=>{this.processedItems().push(e),this.runOnTaskFinishedHandlers(e)});this.tasks().push(r),this.runOnTaskStartedHandlers(e)}async createTaskFor(e,t){if(void 0===this.taskTimeout())return this.handler(e,t,this);let[r,s]=this.createTaskTimeout(e);return Promise.race([this.handler(e,t,this),r()]).finally(s)}createTaskTimeout(e){let t;return[async()=>new Promise((r,s)=>{t=setTimeout(()=>{s(new i.PromisePoolError("Task in promise pool timed out after ".concat(this.taskTimeout(),"ms"),e))},this.taskTimeout())}),()=>clearTimeout(t)]}save(e,t){return this.shouldUseCorrespondingResults()?this.results()[t]=e:this.results().push(e),this}removeActive(e){return this.tasks().splice(this.tasks().indexOf(e),1),this}async handleErrorFor(e,t,r){if(this.shouldUseCorrespondingResults()&&(this.results()[r]=s.PromisePool.failed),!this.isStoppingThePoolError(e)){if(this.isValidationError(e))throw this.markAsStopped(),e;this.hasErrorHandler()?await this.runErrorHandlerFor(e,t):this.saveErrorFor(e,t)}}isStoppingThePoolError(e){return e instanceof n.StopThePromisePoolError}isValidationError(e){return e instanceof o.ValidationError}async runErrorHandlerFor(e,t){try{var r;await (null==(r=this.errorHandler)?void 0:r.call(this,e,t,this))}catch(e){this.rethrowIfNotStoppingThePool(e)}}runOnTaskStartedHandlers(e){this.onTaskStartedHandlers.forEach(t=>{t(e,this)})}runOnTaskFinishedHandlers(e){this.onTaskFinishedHandlers.forEach(t=>{t(e,this)})}rethrowIfNotStoppingThePool(e){if(!this.isStoppingThePoolError(e))throw e}saveErrorFor(e,t){this.errors().push(i.PromisePoolError.createFrom(e,t))}async drained(){return await this.drainActiveTasks(),{errors:this.errors(),results:this.results()}}async drainActiveTasks(){await Promise.all(this.tasks())}constructor(){this.meta={tasks:[],items:[],errors:[],results:[],stopped:!1,concurrency:10,shouldResultsCorrespond:!1,processedItems:[],taskTimeout:0},this.handler=e=>e,this.errorHandler=void 0,this.onTaskStartedHandlers=[],this.onTaskFinishedHandlers=[]}}},832405,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PromisePool=void 0;let s=e.r(733400);class o{withConcurrency(e){return this.concurrency=e,this}static withConcurrency(e){return new this().withConcurrency(e)}withTaskTimeout(e){return this.timeout=e,this}static withTaskTimeout(e){return new this().withTaskTimeout(e)}for(e){let t=new o(e).withConcurrency(this.concurrency);return"function"==typeof this.errorHandler&&t.handleError(this.errorHandler),"number"==typeof this.timeout?t.withTaskTimeout(this.timeout):t}static for(e){return new this().for(e)}handleError(e){return this.errorHandler=e,this}onTaskStarted(e){return this.onTaskStartedHandlers.push(e),this}onTaskFinished(e){return this.onTaskFinishedHandlers.push(e),this}useCorrespondingResults(){return this.shouldResultsCorrespond=!0,this}async process(e){return new s.PromisePoolExecutor().useConcurrency(this.concurrency).useCorrespondingResults(this.shouldResultsCorrespond).withTaskTimeout(this.timeout).withHandler(e).handleError(this.errorHandler).onTaskStarted(this.onTaskStartedHandlers).onTaskFinished(this.onTaskFinishedHandlers).for(this.items).start()}constructor(e){this.timeout=void 0,this.concurrency=10,this.items=null!=e?e:[],this.errorHandler=void 0,this.onTaskStartedHandlers=[],this.onTaskFinishedHandlers=[],this.shouldResultsCorrespond=!1}}r.PromisePool=o,o.notRun=Symbol("notRun"),o.failed=Symbol("failed")},330523,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0})},957091,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0})},722464,(e,t,r)=>{"use strict";var s=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),r.default=e.r(832405).PromisePool,o(e.r(330523),r),o(e.r(832405),r),o(e.r(223088),r),o(e.r(957091),r),o(e.r(907523),r),o(e.r(784138),r)},497808,(e,t,r)=>{var s=e.r(795014),o=e.r(170237),i=e.r(304653),n=Math.ceil,a=Math.max;t.exports=function(e,t,r){t=(r?o(e,t,r):void 0===t)?1:a(i(t),0);var l=null==e?0:e.length;if(!l||t<1)return[];for(var c=0,d=0,u=Array(n(l/t));c<l;)u[d++]=s(e,c,c+=t);return u}},390421,422091,e=>{"use strict";e.s(["batchDelete",()=>B,"batchSet",()=>K,"createDoc",()=>O,"deleteByQuery",()=>_,"deleteDoc",()=>j,"setDoc",()=>N],390421);var t=e.i(386601);e.i(151718);var r=e.i(506973),s=e.i(411595),o=e.i(447285),i=e.i(881285),n=e.i(387888),a=e.i(89842);let l=(e,t,r)=>{let s=(0,i.applyGlobalOptions)(t),l={isTestDoc:!1,...e};return s.isTestDoc?l={...l,isTestDoc:!0}:r&&(0,o.isTestDocId)(r)&&(l={...l,isTestDoc:!0}),{data:l,options:s,idWithTestDocTakenIntoAccount:s.isTestDoc?r?(0,o.isTestDocId)(r)?r:(0,a.getTestDocId)(r):(0,n.getUuid)({isTestDoc:!0}):r}};var c=e.i(943545),d=e.i(691027);e.s(["DeleteField",()=>f,"deepMapObj",()=>m],422091);var u=e.i(947423),h=e.i(101320);let f="__delete__",m=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(null===e||"object"!=typeof e)return e;let s=void 0!==e.length?[]:{};return(0,u.default)(e,function(e,o){let i=void 0!==(null==e?void 0:e.length),n="".concat(r).concat(o),a=t(e,n);if(void 0!==a){if(a!==f){s[o]=a;return}}else(0,h.default)(e)||i?s[o]=m(e,t,"".concat(n,".")):s[o]=e}),s},p=e=>m((0,d.default)(e,"uid"),(e,t)=>{if(t.endsWith("_snapshot"))return f});var y=e.i(736749),v=e.i(619901),g=e.i(717038),T=e.i(230026);e.s(["batchDelete",()=>F,"batchSet",()=>S,"createDoc",()=>D,"deleteByQuery",()=>C,"deleteDoc",()=>E,"setDoc",()=>x],991615);var w=e.i(722464);e.i(436180);var b=e.i(98925),k=e.i(497808),P=e.i(908083);let R=()=>({createdAt:b.Timestamp.now(),updatedAt:b.Timestamp.now(),archived:!1}),x=async(e,t,r,s)=>{var o;let i=await (0,P.initFbWithBeAuthIfNeeded)();return await (0,b.setDoc)((0,b.doc)(i,e,t),{updatedAt:b.Timestamp.now(),...p(r)},{merge:null==(o=null==s?void 0:s.merge)||o}),(0,b.doc)(i,e,t)},E=async(e,t,r)=>{let s=await (0,P.initFbWithBeAuthIfNeeded)();(null==r?void 0:r.softDelete)?await (0,b.setDoc)((0,b.doc)(s,e,t),{archived:!0},{merge:!0}):await (0,b.deleteDoc)((0,b.doc)(s,e,t))},D=async(e,t,r)=>{var s,o;let i=await (0,P.initFbWithBeAuthIfNeeded)(),a=null!=(s=null==r?void 0:r.id)?s:(0,n.getUuid)(),l=(0,b.doc)(i,e,a);return await (0,b.setDoc)(l,{...R(),...p(t)},{merge:null==(o=null==r?void 0:r.merge)||o}),l},S=async function(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,o=arguments.length>4?arguments[4]:void 0,i=await (0,P.initFbWithBeAuthIfNeeded)(),a=Array.from((0,k.default)(t,s).entries()),{results:l,errors:c}=await w.PromisePool.withConcurrency(5).for(a).process(async t=>{let[a,l]=t,c=(0,b.writeBatch)(i);return l.forEach((t,l)=>{var d;let u={...t,...!r?R():{}},h=r?(0,b.doc)(i,e,r(t,l+a*s)):(0,b.doc)((0,b.collection)(i,e),(0,n.getUuid)());c.set(h,p(u),{merge:null==(d=null==o?void 0:o.merge)||d})}),c.commit()});if(c.length>0)throw console.error("batch set errors",c),Error("batch set errors");return l},F=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,s=arguments.length>3?arguments[3]:void 0,o=await (0,P.initFbWithBeAuthIfNeeded)(),i=Array.from((0,k.default)(t,r).entries()),{results:n}=await w.PromisePool.withConcurrency(5).for(i).process(async t=>{let[,r]=t,i=(0,b.writeBatch)(o);return r.forEach(t=>{let r=(0,b.doc)(o,e,t);(null==s?void 0:s.softDelete)?i.set(r,{archived:!0},{merge:!0}):i.delete(r)}),i.commit()});return n},C=async function(t,r){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,o=arguments.length>3?arguments[3]:void 0;await (0,P.initFbWithBeAuthIfNeeded)();let{readQuery:i}=await e.A(160975),n=await i(t,r);return 0===n.length?[]:F(t,n.map(e=>e.uid).filter(Boolean),s,o)};var A=e.i(991615);let U=()=>(0,y.isServerside)()&&!T._isStub&&(0,c.isUnauthenticatedAdminBe)()?T:null,H=async(e,t,o,i,n)=>{let a=null;if(!(0,y.isServerside)()){var l;a=(null==(l=(0,r.getAuth)().currentUser)?void 0:l.uid)||null}let c=await (0,g.readDoc)(t,o),d=(0,s.default)(c,i),u=await e.createDoc("documentVersion",{documentKey:o,collectionName:t,documentData:d,revertedToVersionKey:null!=n?n:null,updatedByUserKey:a});return{...i,versionKey:u.id}},I=async(e,t,o,i)=>{var a,l,c;let d=null;(0,y.isServerside)()||(d=(null==(l=(0,r.getAuth)().currentUser)?void 0:l.uid)||null);let u=o.map(()=>(0,n.getUuid)()),h=null!=(c=null==(a=e.backendNow)?void 0:a.call(e))?c:void 0,f=await Promise.all(o.map(async(e,r)=>{let o=(null==i?void 0:i(e,r))||(0,n.getUuid)(),a=await (0,g.readDoc)(t,o);return{documentKey:o,collectionName:t,documentData:(0,s.default)(a,e),updatedByUserKey:d,...h?{createdAt:h,updatedAt:h,archived:!1}:{}}}));return await e.batchSet("documentVersion",f,(e,t)=>u[t]),f.map((e,t)=>({...e.documentData,versionKey:u[t],uid:e.documentKey}))},N=async(e,r,s,o)=>(0,v.withErrorContext)({collectionName:e,docId:r,methodName:"setDoc"},async()=>{let i=(0,t.getUpdatedPermissionsForCollection)(e,s),n=U()||A,{data:a,options:c}=l((null==o?void 0:o.recordVersion)||(null==o?void 0:o.isRevertingToVersionKey)?await H(n,e,r,i,null==o?void 0:o.isRevertingToVersionKey):i,null!=o?o:{},r);return n.setDoc(e,r,p(a),c)}),j=async(e,t,r)=>(0,v.withErrorContext)({collectionName:e,docId:t,methodName:"deleteDoc"},async()=>{let s=U();return s?s.deleteDoc(e,t,r):A.deleteDoc(e,t,r)}),O=async(e,r,s)=>(0,v.withErrorContext)({collectionName:e,docId:null==s?void 0:s.id,methodName:"createDoc"},async()=>{let o=(0,t.getUpdatedPermissionsForCollection)(e,r),i=U()||A,a=(null==s?void 0:s.id)||(0,n.getUuid)(),{data:c,options:d,idWithTestDocTakenIntoAccount:u}=l((null==s?void 0:s.recordVersion)?await H(i,e,a,o):o,null!=s?s:{},a);return i.createDoc(e,p(c),{...d,id:u})}),K=async function(e,r,s){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4?arguments[4]:void 0;return(0,v.withErrorContext)({collectionName:e,methodName:"batchSet"},async()=>{let n=r.map(r=>(0,t.getUpdatedPermissionsForCollection)(e,r)),a=U()||A,c=((null==i?void 0:i.recordVersion)?await I(a,e,n,s):n).map((e,t)=>{let r=s?s(e,t):void 0,{data:o}=l(e,null!=i?i:{},r);return o}),d=(null==i?void 0:i.recordVersion)?e=>e.uid:s;return a.batchSet(e,c,d,o,i)})},B=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(0,v.withErrorContext)({collectionName:e,methodName:"batchDelete"},async()=>{let s=U();return s?s.batchDelete(e,t,r):A.batchDelete(e,t,r)})},_=async(e,t,r)=>(0,v.withErrorContext)({collectionName:e,methodName:"deleteByQuery"},async()=>{let s=U();return s?s.deleteByQuery(e,t,null==r?void 0:r.batchSize,r):A.deleteByQuery(e,t,null==r?void 0:r.batchSize,r)})}]);

//# sourceMappingURL=4a1365cb6ab2e0ff.js.map
//# debugId=05567370-510d-5e64-b0b9-86d67f0d300e
